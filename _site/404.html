<!DOCTYPE html>
<html>

<script type="text/javascript">
//<![CDATA[
var langs = {"en":{"countries":["US","GB","AU"],"label":"English","path":"/en","root":true},"de":{"countries":["DE"],"label":"Deutsch","path":"/de"},"fr":{"countries":["FR","CA"],"label":"Français","path":"/fr"},"ja":{"countries":["JP"],"label":"日本語","path":"/ja"},"zh-Hans":{"countries":["CN","SG"],"label":"中文","path":"/zh-Hans"},"zh-Hant":{"countries":["HK","TW"],"label":"中文","path":"/zh-Hant"},"ko":{"countries":["KR"],"label":"한국어","path":"/ko"}};
var from404 = 'true'=='true' || false;
var baselang = 'en';
//for IE8
if (!Array.prototype.filter) {
  Array.prototype.filter = function(fun /*, thisp*/) {
    var len = this.length >>> 0;
    if (typeof fun != "function")
    throw new TypeError();

    var res = [];
    var thisp = arguments[1];
    for (var i = 0; i < len; i++) {
      if (i in this) {
        var val = this[i]; // in case fun mutates this
        if (fun.call(thisp, val, i, this))
        res.push(val);
      }
    }
    return res;
  };
}
function urlparam(name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
}
function getParameterByName(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}
function redirect(url) {
    //docs for Google Search Engine Crawling : https://www.google.com/support/enterprise/static/gsa/docs/admin/70/gsa_doc_set/admin_crawl/advanced_topics.html#1076239
    var ua        = navigator.userAgent.toLowerCase(),
        isIE      = ua.indexOf('msie') !== -1,
        version   = parseInt(ua.substr(4, 2), 10);
    // Internet Explorer 8 and lower
    if (isIE && version < 9) {
        var link = document.createElement('a');
        link.href = url;
        document.body.appendChild(link);
        link.click();
    }
    // All other browsers can use the standard window.location.href (they don't lose HTTP_REFERER like IE8 & lower does)
    else {
        window.location.href = url;
    }
}
function langMatcher(format_lang, format_regions){
    // /^fr[-_](FR|CA)$/i or /^fr.*$/i
    return new RegExp(['^', format_lang, format_regions ? '[-_]('+format_regions.join('|')+')' : '.*', '$'].join(''), 'i');
}
function isRootPath(){
    return window.location.pathname == '/';
}
function currentpath(){
    return isRootPath() ? "": "/"+window.location.pathname.split('/').filter(Boolean).join('/');
}
function lastpathname(offset){
    return window.location.pathname.split('/').filter(Boolean).slice(-(1+(offset || 0)))[0];
}
function lastpath(offset){
    return "/"+lastpathname(offset);
}
function replacelastpath(path){
    return window.location.pathname.substring(0, window.location.pathname.indexOf(lastpath()))+path
}
function matchedrelativepath(){
    var language = /*'' || */window.navigator.userLanguage || window.navigator.language;

    for (var lang in langs){
        var lobj = langs[lang];
        var l = lang.split('-');
        var matcher = langMatcher(l[0], l[1] && lobj.countries.concat(l[1])); //zh-Hans -> langMatcher(zh, ['Hans','CN','SG']);
        var _lastpathname = lastpathname();
        var matchedViaPath = _lastpathname && _lastpathname.replace(/^\s+|\s+$/g, '').match(matcher);
        var matchedViaUserLang = language ? language.match(matcher) : false;
        // 1st Priority : matched path
        if(matchedViaPath){
            return lobj.path;
        }
        // 2st Priority : browser lang
        if(matchedViaUserLang){
            return lobj.path;
        }
    }
    return null;
}
function redirectIfMatch(){
    if(getParameterByName('lang')){
        return false;
    }

    var mpath = matchedrelativepath();
    if(from404){
        var blang = langs[baselang];
        if(blang.path == lastpath()){
            redirect('/');
        }else{
            if(mpath == lastpath()){
                // 404 -> tried matched path -> but also 404 -> forward to base
                redirect(replacelastpath(blang.path));
            }else{
                // 404 -> tried matched path
                redirect(replacelastpath(mpath));
            }
        }
        return true;

    }else{
        if(mpath){
            if(mpath == lastpath()){
                return false;
            }
            redirect(currentpath()+mpath);
            return true;
        }
    }

    return false;
}

//automatic redirect
try{
    if(!redirectIfMatch()){
        if(window.location.pathname.slice(-1)=='/'){
            redirect(currentpath());
        }
    }
}finally{}
//]]>
</script>


</html>
