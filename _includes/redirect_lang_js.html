<script type="text/javascript">
//<![CDATA[
function redirect(url) {
    var ua        = navigator.userAgent.toLowerCase(),
        isIE      = ua.indexOf('msie') !== -1,
        version   = parseInt(ua.substr(4, 2), 10);
    // Internet Explorer 8 and lower
    if (isIE && version < 9) {
        var link = document.createElement('a');
        link.href = url;
        document.body.appendChild(link);
        link.click();
    }
    // All other browsers can use the standard window.location.href (they don't lose HTTP_REFERER like IE8 & lower does)
    else {
        window.location.href = url;
    }
}
function langMatcher(format_lang, format_regions){
    // /^fr[-_](FR|CA)$/i or /^fr.*$/i
    return new RegExp(['^', format_lang, format_regions ? '[-_]('+format_regions.join('|')+')' : '.*', '$'].join(''), 'i');
}
function redirectIfMatchLang(){
    var langs = {{ site.langs | jsonify }};
    var language = window.navigator.userLanguage || window.navigator.language;
    console.log(language);
    for (var lang in langs){
        var l = lang.split('-');
        var lobj = langs[lang];
        //zh-Hans -> langMatcher(zh, ['Hans','CN','SG']);
        var matcher = langMatcher(l[0], l[1] && lobj.countries.concat(l[1]));
        if(language.match(matcher)){
            redirect(lobj.path);
            return true;
        }
    }
    return false;
}
function redirectIfMatchPath(){
    var langs = {{ site.langs | jsonify }};
    var language = window.navigator.userLanguage || window.navigator.language;
    var basepath = window.location.pathname && window.location.pathname.split('/')[1];
    if(basepath){
        for (var lang in langs){
            var l = lang.split('-');
            var lobj = langs[lang];
            //zh-Hans -> langMatcher(zh, ['Hans','CN','SG']);
            var matcher = langMatcher(l[0], l[1] && lobj.countries.concat(l[1]));
            if(basepath.replace(/^\s+|\s+$/g, '').match(matcher) || language.match(matcher)){
                redirect(lobj.path);
                return true;
            }
        }
    }
    return false;
}
redirectIfMatchPath();
//]]>
</script>
